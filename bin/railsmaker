#!/usr/bin/env ruby
# frozen_string_literal: true

require 'railsmaker'
require 'thor'

module RailsMaker
  class CLI < Thor
    include Thor::Actions

    register RailsMaker::Generators::DockerGenerator,
             'remote:init',
             'remote:init SSH_HOST SSH_USER [--key-path=PATH]',
             'Check and install Docker on a remote Ubuntu server'

    register RailsMaker::Generators::AppGenerator,
             'app:light',
             'app:light APP_NAME DOCKER_USERNAME IP_ADDRESS DOMAIN [--skip-daisyui]',
             'Generate a new Rails application with a KAMAL deployment'

    register RailsMaker::Generators::SignozGenerator,
             'remote:signoz:server',
             'remote:signoz:server SSH_HOST SSH_USER [--key-path=PATH]',
             'Install SigNoz on a remote server'

    register RailsMaker::Generators::SignozOpentelemetryGenerator,
             'remote:signoz:opentelemetry',
             'remote:signoz:opentelemetry SSH_HOST SSH_USER SIGNOZ_HOST [--key-path=PATH] [--override-hostname=HOSTNAME]',
             'Install SigNoz OpenTelemetry client on a remote server'

    register RailsMaker::Generators::PlausibleGenerator,
             'remote:plausible:server',
             'remote:plausible:server SSH_HOST SSH_USER ANALYTICS_HOST [--key-path=PATH]',
             'Install Plausible Analytics on a remote server'

    register RailsMaker::Generators::AuthGenerator,
             'app:auth',
             'app:auth FROM_EMAIL HOSTNAME',
             'Include authentication in the application'

    register RailsMaker::Generators::OpentelemetryGenerator,
             'app:opentelemetry',
             'app:opentelemetry SERVICE_NAME',
             'Configure OpenTelemetry instrumentation for the application'

    register RailsMaker::Generators::PlausibleInstrumentationGenerator,
             'app:plausible',
             'app:plausible APP_DOMAIN ANALYTICS_DOMAIN',
             'Add Plausible Analytics tracking to the application'

    register RailsMaker::Generators::SentryGenerator,
             'app:sentry',
             'app:sentry',
             'Configure Sentry error tracking for the application'

    register RailsMaker::Generators::AppFullGenerator,
             'app:full',
             'app:full APP_NAME DOCKER_USERNAME IP_ADDRESS DOMAIN ANALYTICS_DOMAIN FROM_NAME FROM_EMAIL [--skip-daisyui]',
             'Generate a new Rails application with all default integrations'

    register RailsMaker::Generators::UiGenerator,
             'app:ui',
             'app:ui HOSTNAME',
             'Include UI in the application'

    register RailsMaker::Generators::MailjetGenerator,
             'app:mailjet',
             'app:mailjet FROM_NAME FROM_EMAIL HOSTNAME',
             'Configure Mailjet for sending emails'

    register RailsMaker::Generators::LitestreamGenerator,
             'app:litestream',
             'app:litestream BUCKET_NAME APP_NAME IP_ADDRESS',
             'Configure Litestream database backups to S3'

    def self.exit_on_failure?
      true
    end
  end
end

RailsMaker::CLI.start
